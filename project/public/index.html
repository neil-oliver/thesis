<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
  <div id="app">
    <div id="intro">
      <h2>Followers</h2>
      <input type="number" onchange="this.value = Math.floor(this.value)" class="number-select" v-model="followers_count" min="0" :max="maxFollowers" step="1" id="followerSelect">
      <h2>Retweets</h2>
      <input type="number" onchange="this.value = Math.floor(this.value)" class="number-select" v-model="retweet_count" min="0" :max="maxRetweets" step="1" id="retweetSelect">
      <h2>Likes</h2>
      <input type="number" onchange="this.value = Math.floor(this.value)" class="number-select" v-model="favorite_count" min="0" :max="maxLikes" step="1" id="likeSelect">
      <h2>Comments</h2>
      <input type="number" onchange="this.value = Math.floor(this.value)" class="number-select" v-model="reply_count" min="0" :max="maxComments" step="1" id="commentSelect">
    </div>
    <div id="sidebar">
      <div class='selection'>
        <label for="startDateSlider">Start Date</label>
        <input type="range" min="0" max="60" v-model="startPeriod" class="slider" id="startDateSlider">{{startDate}}
      </div>
      <div class='selection'>
        <label for="endDateSlider">End Date</label>
        <input type="range" min="1" max="60" v-model="endPeriod" class="slider" id="endDateSlider">{{endDate}}
      </div>
      <div class='selection'>
        <span class='label'>Total Tweets</span>
        <span class='value'>{{tweets.length}}</span>
      </div>
      <div class='selection'>
        <span class='label'>Filtered Tweets</span>
        <span class='value'>{{filteredTweets.length}}</span>
      </div>
      <div class='selection'>
        <span class='label'>Number of {{timePeriod}}s</span>
        <span class='value'>{{aggregateTweets.length}}</span>
      </div>
      <div class='selection'>
        <label for="timeperiod">Time Period</label>
        <select id="timeperiod" v-model="timePeriod">
          <option value="minute">Minute</option>
          <option value="hour">Hour</option>
        </select>
      </div>
      <div class='selection'>
        <label for="followerSlider">Followers</label>
        <input type="range" min="0" :max="maxFollowers" v-model="followers_count" class="slider" step="10" id="followerSlider">{{followers_count}}
      </div>
      <div class='selection'>
        <label for="retweetSlider">Retweets</label>
        <input type="range" min="0" :max="maxRetweets" v-model="retweet_count" class="slider" step="10" id="retweetSlider">{{retweet_count}}
      </div>
      <div class='selection'>
        <label for="likeSlider">Likes</label>
        <input type="range" min="0" :max="maxLikes" v-model="favorite_count" class="slider" step="10" id="likeSlider">{{favorite_count}}
      </div>
      <div class='selection'>
        <label for="commentSlider">Comments</label>
        <input type="range" min="0" :max="maxComments" v-model="reply_count" class="slider" step="10" id="commentSlider">{{reply_count}}
      </div>
      <div class='selection'>
        <label for="commentSlider">Sentiment</label>
        <input type="range" min="0" :max="1" v-model="sentiment_min" class="slider" step="0.05" id="sentimentSlider">{{sentiment_min}}
      </div>
      <div class='selection'>
        <label for="verifiedCheckbox">Verified Status Only</label>
        <input type="checkbox" v-model="verified" id='verifiedCheckbox'>
      </div>
      <div class='selection'>
        <label for="gridCheckbox">Grid</label>
        <input type="checkbox" v-model="grid" id='gridCheckbox'>
      </div>
    </div>
    <!-- <div id="latest-tweet">
      <h2>Latest Tweet</h2>
      <h3>{{tweets[tweets.length-1].text}}</h3>
    </div> -->
    <div id="main">
      <div class='vis' id='correlation'>
        <svg :width="svgWidth" :height="svgHeight">
          <g :transform="'translate(' + margin.left + ',' + margin.top + ')'">
            <line :x1="0" :y1="sentimentScale.y(0)" :x2="width" :y2="sentimentScale.y(0)" style="stroke:rgb(19, 105, 163);stroke-width:2" />
            <g>
              <path v-for="(element, index) in sentimentPaths" :d="element.path" :stroke='element.color' stroke-width='2px'/>
              <path :d="candlePath" stroke='#000' stroke-width='3px'/>
              <circle v-for="(element, index) in aggregateCandles"
              :cx="priceScale.x(new Date(element.key))"
              :cy="priceScale.y(element.value.closeAvg)"
              r="4" stroke="#000" stroke-width="3" fill='#fff' />
            </g>
            <g v-axis:x="sentimentScale" :transform="`translate(0, ${height})`"></g>
            <g v-axis:y="sentimentScale"></g>
          </g>
        </svg>
      </div>
      <div>
        <span>Correlation: {{correlation}}</span>
        <span>Likes Weighted Correlation: {{likeWeightedCorrelation}}</span>
        <span>Comments Weighted Correlation: {{commentWeightedCorrelation}}</span>
        <span>Followers Weighted Correlation: {{followerWeightedCorrelation}}</span>
        <span>Interactions Weighted Correlation: {{interactionWeightedCorrelation}}</span>
      </div>
      <div class='vis' id='bubbles'>
        <svg :width="svgWidth" :height="svgHeight">
          <g :transform="'translate(' + margin.left + ',' + margin.top + ')'">
            <g v-for="(element, i) in filteredTweets" @mouseover="tweetTooltip(element)" @mouseout='tooltipVisible = false'>
              <circle :cx="bubbleScale(element,i).x" :cy="bubbleScale(element,i).y" :r="bubbleScale(element,i).size" :fill="bubbleScale(element,i).color"/>
              <circle :cx="bubbleScale(element,i).x" :cy="bubbleScale(element,i).y" :r="bubbleScale(element,i).size + bubbleScale(element,i).strokeSize"  :fill="bubbleScale(element,i).color" :fill-opacity="bubbleScale(element,i).opacity" :stroke-opacity="bubbleScale(element,i).strokeOpacity" :stroke="bubbleScale(element,i).color" stroke-width='1px' stroke-dasharray="2"/>
            </g>
          </g>
        </svg>
      </div>
      <div class='vis' id='stacked'>
        <svg :width="svgWidth" :height="svgHeight">
          <g :transform="'translate(' + margin.left + ',' + margin.top + ')'">
            <g v-for="(row, i) in stack">
              <rect v-for="(block, index) in stack[i]" @mouseover="tweetTooltip(block.data.values[index])" @mouseout='tooltipVisible = false'
                :height="stackScale.y(block[0]) - stackScale.y(block[1])"
                :width="width/aggregateTweets.length"
                :x="stackScale.x(new Date(block.data.key))"
                :y="stackScale.y(block[1])"
                fill="#8addff"
                stroke="#8addff"
                :fill-opacity="i % 2 ? 0.2 : 0.6"
              />
            </g>
            <g v-axis:x="stackScale" :transform="`translate(0, ${height})`"></g>
            <g v-axis:y="stackScale"></g>
          </g>
        </svg>
        <label for="stacked-selection">Choose a Y Axis:</label>
        <select v-model="stacked_select" id="stacked-selection">
          <option value="tweets">Tweets</option>
          <option value="followers">Followers</option>
          <option value="likes">Likes</option>
          <option value="retweets">Retweets</option>
        </select>
      </div>
    </div>
    <div id='tooltip' v-bind:class="{ active: tooltipVisible }"></div>
  </div>
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  <!-- <script src="/socket.io/socket.io.js"></script> -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js'></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script sync src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  <script>

    twttr.widgets.createTweet('20', document.querySelector('#tooltip'));

  </script>
  <script src="./js/main.js"></script>
</body>
</html>